#!/bin/sh

# aesdchar driver init script
# Loads the aesdchar kernel module and creates device node

module=aesdchar
device=aesdchar
mode="664"

case "$1" in
    start)
        echo "Loading aesdchar driver..."
        
        # Load the module
        modprobe ${module} || exit 1
        
        # Get the major number
        major=$(awk "\$2==\"$module\" {print \$1}" /proc/devices)
        
        # Remove old device node if exists
        rm -f /dev/${device}
        
        # Create new device node
        mknod /dev/${device} c $major 0
        
        # Set permissions
        chmod $mode /dev/${device}
        
        echo "aesdchar driver loaded successfully"
        ;;
        
    stop)
        echo "Unloading aesdchar driver..."
        
        # Remove device node
        rm -f /dev/${device}
        
        # Unload module
        rmmod ${module} || exit 1
        
        echo "aesdchar driver unloaded"
        ;;
        
    restart)
        $0 stop
        $0 start
        ;;
        
    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac

exit 0
